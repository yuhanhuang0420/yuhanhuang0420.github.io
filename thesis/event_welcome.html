<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
	<title>Welcome Effect</title>
	<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
	<style>
		.message {
			height: 100%;
			width: 100%;
			position: absolute;
			top: 0;
			left: 0;
			background-color: rgba(0, 0, 0, 0.8);
			z-index: 9999;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.message div {
			text-align: center;
			font-size: 1.25em;
			color: white;
		}
	</style>
</head>

<body style="margin: 0; overflow: hidden;">
	<div class="message">
		<div>You are not near the event area</div>
	</div>
	<div class="model" style="width:100%">
		<!--model download from: https://sketchfab.com/3d-models/animated-3d-tyrannosaurus-rex-dinosaur-loop-5339a88494084a98bd2bb1104a7f48f0-->
		<model-viewer style="width:100%; height:600px;"
		src="../assets/animated_dinosaur/scene.gltf"
		ios-src="../assets/animated_dinosaur/Animated_Dinosaur.usdz"
		ar
		ar-modes="webxr scene-viewer quick-look fallback"
		autoplay
		camera-controls
		alt="3D model of a dinosaur"
		>
			<button slot="ar-button" style="background-color: #BEBEBE; border-radius: 4px; border: none; position: absolute; top: 16px; left: 50%; ">
				ğŸ‘‹ é»æ­¤é–‹å•ŸAR
			</button>
		</model-viewer>
	</div>
	
	<script>
		//æ¸¬é‡ç³»é¤¨é™„è¿‘ç¯„åœ
		let GM = [{"x": 120.220377,"y": 22.998302},{"x": 120.219016,"y": 22.998409},{"x": 120.219093,"y": 22.99938},{"x": 120.22046,"y": 22.999265}];
		
		//watch position for outdoor
		let watchID = navigator.geolocation.watchPosition(function(position) {
			let p = {"x":position.coords.longitude, "y": position.coords.latitude};
			if (windingNumber(p, GM) == 'on' || windingNumber(p, GM) == 'in'){
				document.querySelector(".message").setAttribute('style', 'display:none');
				alert("Welcome to Geomatics department to join our event!");
			}
		});
		setTimeout(function() {
			let p = {"x":120.219989, "y": 22.998467};
			if (windingNumber(p, GM) == 'on' || windingNumber(p, GM) == 'in'){
				document.querySelector(".message").setAttribute('style', 'display:none');
				alert("Welcome to Geomatics department to join our event!");
			}
		}, 10000);
		
		//withinåˆ¤æ–·
		/**https://www.itread01.com/content/1547955205.html
		* @description è¿´è½‰æ•¸æ³•åˆ¤æ–·é»æ˜¯å¦åœ¨å¤šé‚Šå½¢å…§éƒ¨
		* @param {Object} p å¾…åˆ¤æ–·çš„é»ï¼Œæ ¼å¼ï¼š{ x: Xåº§æ¨™, y: Yåº§æ¨™ }
		* @param {Array} poly å¤šé‚Šå½¢é ‚é»ï¼Œé™£åˆ—æˆå“¡çš„æ ¼å¼åŒ p
		* @return {String} é» p å’Œå¤šé‚Šå½¢ poly çš„å¹¾ä½•é—œä¿‚
		*/
		function windingNumber(p, poly) {
			var px = p.x,
			py = p.y,
			sum = 0;

			for(var i = 0, l = poly.length, j = l - 1; i < l; j = i, i++) {
				var sx = poly[i].x,
				  sy = poly[i].y,
				  tx = poly[j].x,
				  ty = poly[j].y;

				// é»èˆ‡å¤šé‚Šå½¢é ‚é»é‡åˆæˆ–åœ¨å¤šé‚Šå½¢çš„é‚Šä¸Š
				if((sx - px) * (px - tx) >= 0 && (sy - py) * (py - ty) >= 0 && (px - sx) * (ty - sy) === (py - sy) * (tx - sx)) {
					return 'on'
				}
				// é»èˆ‡ç›¸é„°é ‚é»é€£ç·šçš„å¤¾è§’
				var angle = Math.atan2(sy - py, sx - px) - Math.atan2(ty - py, tx - px);

				// ç¢ºä¿å¤¾è§’ä¸è¶…å‡ºå–å€¼ç¯„åœï¼ˆ-Ï€ åˆ° Ï€ï¼‰
				if(angle >= Math.PI) {
					angle = angle - Math.PI * 2;
				} else if(angle <= -Math.PI) {
					angle = angle + Math.PI * 2;
				}
				sum += angle;
			}
			// è¨ˆç®—è¿´è½‰æ•¸ä¸¦åˆ¤æ–·é»å’Œå¤šé‚Šå½¢çš„å¹¾ä½•é—œä¿‚
			return Math.round(sum / Math.PI) === 0 ? 'out' : 'in'
		};
	</script>
</body>
</html>
